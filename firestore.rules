// Firestore Security Rules for KAYA Fitness App
// Note: This app uses LINE LIFF authentication (not Firebase Auth)
// Security is handled at app level with LINE userId

rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // ==================== OPEN ACCESS ====================
    // Since we use LINE LIFF authentication (not Firebase Auth),
    // we allow read/write access and handle security at application level
    // The app validates LINE userId before any database operations
    
    // ==================== GAME SCORES ====================
    
    match /gameScores/{scoreId} {
      allow read: if true;
      allow create: if true;
      allow update, delete: if false;
    }
    
    // ==================== LEADERBOARDS ====================
    
    match /leaderboards/{leaderboardId} {
      allow read: if true;
      allow write: if true;
    }
    
    // ==================== USER GAME STATS ====================
    
    match /userGameStats/{userId} {
      allow read, write: if true;
    }
    
    // ==================== USER PROFILES ====================
    
    match /users/{userId} {
      allow read: if true;
      allow create, update: if true;
      allow delete: if false;
    }
    
    match /profiles/{userId} {
      allow read: if true;
      allow create, update: if true;
      allow delete: if false;
    }
    
    // ==================== HEALTH DATA ====================
    
    match /healthData/{userId} {
      allow read, write: if true;
    }
    
    // ==================== WORKOUT HISTORY ====================
    
    match /workoutHistory/{sessionId} {
      allow read: if true;
      allow create: if true;
      allow update, delete: if false;
    }
    
    // ==================== NUTRITION LOGS ====================
    
    match /nutritionLogs/{logId} {
      allow read, write: if true;
    }
    
    // ==================== USER SETTINGS ====================
    
    match /userSettings/{userId} {
      allow read, write: if true;
    }
    
    // ==================== USER THEMES ====================
    
    match /userThemes/{userId} {
      allow read, write: if true;
    }
    
    // ==================== CHALLENGES ====================
    
    match /challenges/{challengeId} {
      allow read: if true;
      allow create: if true;
      allow update: if true;
      allow delete: if false;
    }
    
    // ==================== BADGES ====================
    
    match /badges/{badgeId} {
      allow read: if true;
      allow write: if false;
    }
    
    // User's earned badges
    match /userBadges/{userId}/badges/{badgeId} {
      allow read: if true;
      allow write: if true;
    }
    
    // ==================== CATCH ALL ====================
    // Allow any other collections for flexibility
    match /{document=**} {
      allow read, write: if true;
    }
  }
}
